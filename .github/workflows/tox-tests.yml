# GitHub Actions workflow for testing and continuous integration.
#
# This file performs testing using tox and tox.ini to define and configure the test environments.

name: Python Tests

on:
  push:
    branches:
      - main
    tags:
      - '*'
  pull_request:
  schedule:
    # run every Monday at 6am UTC
    - cron: '0 6 * * 1'
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  tests:
    uses: OpenAstronomy/github-actions-workflows/.github/workflows/tox.yml@9f1fedda61294df4c004c05519a3fbf3b8e1f32f  # v2.3.1
    secrets:
      CODECOV_TOKEN: ${{ secrets.CODECOV }}
    with:
      submodules: false
      coverage: ''
      envs: |
        - name: Codestyle
          linux: codestyle

        - name: Python 3.11 on Linux with oldest supported dependencies
          linux: py311-test-oldestdeps
          toxargs: -v

        - name: Python 3.12 on OSX with minimal dependencies
          macos: py312-test
          toxargs: -v

        - name: Python 3.12 on Windows with minimal dependencies
          windows: py312-test
          toxargs: -v

        - name: Python 3.12 on Linux with minimal dependencies
          linux: py312-test
          toxargs: -v

        - name: Python 3.13 on Linux with minimal dependencies
          linux: py313-test
          toxargs: -v

        - name: Python 3.14 on Linux with all dependencies, remote data, and coverage
          linux: py314-test-alldeps-cov
          coverage: codecov
          toxargs: -v
          posargs: --remote-data=any

        - name: (Allowed Failure) Python 3.14 on Linux with dev dependencies
          linux: py314-test-devdeps-cov
          coverage: codecov
          toxargs: -v
